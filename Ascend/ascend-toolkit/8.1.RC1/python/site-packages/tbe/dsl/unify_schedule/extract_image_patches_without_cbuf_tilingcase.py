# Copyright (c) Huawei Technologies Co., Ltd. 2022. All rights reserved.
#
# licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
# ============================================================================
class EipwcTilingCase:
    def __init__(self, key):
        self.key = key
        self.multi_core_factor = None
        self.workspace_factor = None
        self.y_factor = None


def calc_extract_image_patches_without_cbuf(outs):
    """
    1XXXX: without cbuf

    X0XXX: large c1
    X1XXX: c align
    X2XXX: c not align, db on
    X3XXX: c not align, db off

    XX0XX: multi_core cut n
    XX1XX: multi_core cut ho
    XX2XX: multi_core cut wo
    XX3XX: multi_core cut kh
    XX4XX: multi_core cut kw
    XX5XX: multi_core cut c1

    XXX0X: workspace off
    XXX1X: workspace cut c1
    XXX2X: workspace cut ho
    XXX3X: workspace cut wo
    XXX4X: workspace cut kh
    XXX5X: workspace cut kw

    XXXX0: y cut n
    XXXX1: y cut ho
    XXXX2: y cut wo
    XXXX3: y cut kh
    XXXX4: y cut kw
    XXXX5: y cut c1
    """
    tiling_key_list = [
        10005, 10105, 10205, 10305, 10405, 10505,

        11001, 11002, 11003, 11004,
        11501, 11502, 11503, 11504,
        11101, 11102, 11103, 11104,
        11202, 11203, 11204,
        11303, 11304,
        11404,

        12020, 12021, 12022, 12023, 12024,
        12040, 12041, 12042, 12043, 12044,
        12030, 12031, 12032, 12033, 12034,
        12050, 12051, 12052, 12053, 12054,

        12121, 12122, 12123, 12124,
        12141, 12142, 12143, 12144,
        12131, 12132, 12133, 12134,
        12151, 12152, 12153, 12154,

        12242, 12244,
        12232, 12233, 12234,
        12252, 12253, 12254,

        12303, 12304,
        12404
    ]

    if  outs[0].op.attrs.get("computes")[0].dtype == "int16" or outs[0].op.attrs.get("env_without_cbuf"):
        tiling_key_list += [
            11000, 11005,
            11505,

            12000, 13000,
            12010, 12011, 12012, 12013, 12014,

            13100,
            12111, 12112, 12113, 12114,

            13200,
            12212, 12214
        ]

    tiling_case_list = [EipwcTilingCase(tiling_key) for tiling_key in tiling_key_list]

    return tiling_case_list
