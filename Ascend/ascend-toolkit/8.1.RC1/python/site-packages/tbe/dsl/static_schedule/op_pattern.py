#!/usr/bin/env python
# -*- coding:utf-8 -*-
# Copyright 2019-2020 Huawei Technologies Co., Ltd
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
# ============================================================================
"""
common function
"""
# 'pylint: disable=invalid-name
bn_update_grad_pattern_list = [
    [
        "tuple_reduce_sum",
        "elewise_binary_mul",
        "elewise_single_cast|not_auto_cast",
        "placeholder",
        "elewise_binary_mul",
        "elewise_binary_sub",
        "elewise_single_cast|not_auto_cast",
        "placeholder",
        "broadcast_for_tensor",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_binary_div",
        "broadcast",
        "elewise_single_sqrt",
        "elewise_single_VS_add",
        "placeholder",
        "tuple_reduce_sum"
    ],
    [
        "tuple_reduce_sum",
        "elewise_binary_mul",
        "elewise_single_cast|not_auto_cast",
        "placeholder",
        "elewise_binary_mul",
        "elewise_binary_add",
        "elewise_single_cast|not_auto_cast",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_single_VS_mul",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_binary_div",
        "broadcast",
        "elewise_single_sqrt",
        "elewise_single_VS_add",
        "placeholder",
        "tuple_reduce_sum"
    ],
    [
        "tuple_reduce_sum",
        "elewise_binary_mul",
        "placeholder",
        "elewise_binary_mul",
        "elewise_binary_add",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_single_VS_mul",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_binary_div",
        "broadcast",
        "elewise_single_sqrt",
        "elewise_single_VS_add",
        "placeholder",
        "tuple_reduce_sum",
    ],
    [
        "tuple_reduce_sum",
        "elewise_binary_mul",
        "elewise_single_cast|not_auto_cast",
        "placeholder",
        "elewise_binary_div",
        "elewise_binary_sub",
        "elewise_single_cast|not_auto_cast",
        "placeholder",
        "broadcast_for_tensor",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_single_sqrt",
        "elewise_single_VS_add",
        "placeholder",
        "tuple_reduce_sum"
    ],
    [
        "tuple_reduce_sum",
        "elewise_binary_mul",
        "placeholder",
        "elewise_binary_mul",
        "elewise_binary_sub",
        "placeholder",
        "broadcast_for_tensor",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_binary_div",
        "broadcast",
        "elewise_single_sqrt",
        "elewise_single_VS_add",
        "placeholder",
        "tuple_reduce_sum"
    ],
    # for N*H*W is 1
    [
        "tuple_reduce_sum",
        "elewise_binary_mul",
        "placeholder",
        "elewise_binary_mul",
        "elewise_binary_add",
        "placeholder",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_div",
        "broadcast",
        "elewise_single_sqrt",
        "elewise_single_VS_add",
        "placeholder",
        "tuple_reduce_sum",
    ]
]

# 'pylint: disable=invalid-name
layer_norm_grad_pattern_list = [
    # for layer_norm_beta_gamma_backprop_v2
    [
        "tuple_reduce_sum",
        "elewise_binary_mul",
        "tuple_reduce_sum"
    ],
    # for fp32
    [
        "tuple_reduce_sum",
        "elewise_binary_mul",
        "placeholder",
        "elewise_binary_mul",
        "broadcast_for_tensor",
        "elewise_single_exp",
        "elewise_single_VS_mul",
        "elewise_single_log",
        "elewise_single_VS_add",
        "placeholder",
        "elewise_binary_sub",
        "placeholder",
        "broadcast_for_tensor",
        "placeholder",
        "tuple_reduce_sum"
    ],
    [
        "tuple_reduce_sum",
        "elewise_binary_mul",
        "placeholder",
        "elewise_binary_mul",
        "broadcast_for_tensor",
        "broadcast_for_tensor",
        "elewise_single_exp",
        "elewise_single_VS_mul",
        "elewise_single_log",
        "elewise_single_VS_add",
        "placeholder",
        "elewise_binary_sub",
        "placeholder",
        "broadcast_for_tensor",
        "broadcast_for_tensor",
        "placeholder",
        "tuple_reduce_sum"
    ],
    # for fp16
    [
        "tuple_reduce_sum",
        "elewise_binary_mul",
        "elewise_single_cast|not_auto_cast",
        "placeholder",
        "elewise_binary_mul",
        "broadcast_for_tensor",
        "elewise_single_exp",
        "elewise_single_VS_mul",
        "elewise_single_log",
        "elewise_single_VS_add",
        "elewise_single_cast|not_auto_cast",
        "placeholder",
        "elewise_binary_sub",
        "elewise_single_cast|not_auto_cast",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_single_cast|not_auto_cast",
        "placeholder",
        "tuple_reduce_sum",
    ],
    [
        "tuple_reduce_sum",
        "elewise_binary_mul",
        "elewise_single_cast|not_auto_cast",
        "placeholder",
        "elewise_binary_mul",
        "broadcast_for_tensor",
        "broadcast_for_tensor",
        "elewise_single_exp",
        "elewise_single_VS_mul",
        "elewise_single_log",
        "elewise_single_VS_add",
        "elewise_single_cast|not_auto_cast",
        "placeholder",
        "elewise_binary_sub",
        "elewise_single_cast|not_auto_cast",
        "placeholder",
        "broadcast_for_tensor",
        "broadcast_for_tensor",
        "elewise_single_cast|not_auto_cast",
        "placeholder",
        "tuple_reduce_sum",
    ],
    [
        "tuple_reduce_sum",
        "elewise_binary_mul",
        "placeholder",
        "elewise_binary_mul",
        "elewise_single_exp",
        "elewise_single_VS_mul",
        "elewise_single_log",
        "elewise_single_VS_add",
        "broadcast_for_tensor",
        "placeholder",
        "elewise_binary_sub",
        "placeholder",
        "broadcast_for_tensor",
        "placeholder",
        "tuple_reduce_sum",
    ]
]

# 'pylint: disable=invalid-name
bn_update_pattern_list = [
    # for cloud
    [
        "elewise_single_cast|not_auto_cast",
        "elewise_binary_add",
        "elewise_binary_mul",
        "broadcast_for_tensor",
        "elewise_binary_div",
        "placeholder",
        "elewise_single_sqrt",
        "elewise_single_VS_add",
        "elewise_binary_sub",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_mul",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_single_cast|not_auto_cast",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_binary_sub",
        "placeholder",
        "elewise_binary_mul",
        "elewise_binary_add",
        "elewise_single_VS_mul",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_add",
        "elewise_single_VS_mul",
        "elewise_single_VS_mul",
        "elewise_single_VS_mul",
        "placeholder"
    ],
    # for float16 cloud fusion or res_y at last pos in res
    [
        "elewise_binary_add",
        "elewise_single_VS_mul",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_add",
        "elewise_single_VS_mul",
        "elewise_single_VS_mul",
        "elewise_binary_sub",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_mul",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_single_cast|not_auto_cast",
        "elewise_binary_add",
        "elewise_binary_mul",
        "broadcast_for_tensor",
        "elewise_binary_div",
        "placeholder",
        "elewise_single_sqrt",
        "elewise_single_VS_add",
        "elewise_single_cast|not_auto_cast",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_binary_sub",
        "placeholder",
        "elewise_binary_mul"
    ],
    # for mini fp32
    [
        "elewise_binary_add",
        "elewise_binary_mul",
        "broadcast_for_tensor",
        "elewise_binary_div",
        "placeholder",
        "elewise_single_sqrt",
        "elewise_single_VS_add",
        "elewise_binary_sub",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_mul",
        "elewise_single_VS_mul",
        "placeholder",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_binary_sub",
        "placeholder",
        "elewise_binary_mul",
        "elewise_binary_add",
        "elewise_single_VS_mul",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_add",
        "elewise_single_VS_mul",
        "elewise_single_VS_mul",
        "elewise_single_VS_mul",
        "placeholder"
    ],
    # for cloud fp16 bn_update + relu fusion
    [
        "elewise_single_relu",
        "elewise_single_cast|not_auto_cast",
        "elewise_binary_add",
        "elewise_binary_mul",
        "broadcast_for_tensor",
        "elewise_binary_div",
        "placeholder",
        "elewise_single_sqrt",
        "elewise_single_VS_add",
        "elewise_binary_sub",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_mul",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_single_cast|not_auto_cast",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_binary_sub",
        "placeholder",
        "elewise_binary_mul",
        "elewise_binary_add",
        "elewise_single_VS_mul",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_add",
        "elewise_single_VS_mul",
        "elewise_single_VS_mul",
        "elewise_single_VS_mul",
        "placeholder"
    ],
    # for cloud fp32 bn_update + relu fusion
    [
        "elewise_binary_add",
        "elewise_single_VS_mul",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_add",
        "elewise_single_VS_mul",
        "elewise_single_VS_mul",
        "elewise_binary_sub",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_mul",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_max",
        "elewise_binary_add",
        "elewise_binary_mul",
        "broadcast_for_tensor",
        "elewise_binary_div",
        "placeholder",
        "elewise_single_sqrt",
        "elewise_single_VS_add",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_binary_sub",
        "placeholder",
        "elewise_binary_mul",
    ],
    # for cloud fp32 bn_update + addn + relu fusion
    [
        "elewise_binary_add",
        "elewise_single_VS_mul",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_add",
        "elewise_single_VS_mul",
        "elewise_single_VS_mul",
        "elewise_binary_sub",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_mul",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_max",
        "elewise_binary_add",
        "elewise_binary_add",
        "elewise_binary_mul",
        "broadcast_for_tensor",
        "elewise_binary_div",
        "placeholder",
        "elewise_single_sqrt",
        "elewise_single_VS_add",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_binary_sub",
        "placeholder",
        "elewise_binary_mul",
    ],
    # for mini
    [
        "elewise_single_cast|not_auto_cast",
        "elewise_binary_add",
        "elewise_binary_mul",
        "broadcast_for_tensor",
        "elewise_binary_mul",
        "placeholder",
        "elewise_binary_mul",
        "elewise_single_VS_add",
        "elewise_single_VS_mul",
        "elewise_binary_mul",
        "elewise_binary_mul",
        "elewise_single_VS_add",
        "elewise_single_VS_mul",
        "elewise_binary_mul",
        "elewise_single_rsqrt",
        "elewise_single_VS_add",
        "elewise_binary_sub",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_mul",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_mul",
        "elewise_single_VS_add",
        "elewise_single_VS_mul",
        "elewise_binary_mul",
        "elewise_single_rec",
        "elewise_binary_mul",
        "elewise_single_VS_add",
        "elewise_single_VS_mul",
        "elewise_binary_mul",
        "elewise_single_rec",
        "elewise_single_cast|not_auto_cast",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_binary_sub",
        "placeholder",
        "elewise_binary_mul",
        "elewise_binary_add",
        "elewise_single_VS_mul",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_add",
        "elewise_single_VS_mul",
        "elewise_single_VS_mul",
        "elewise_single_VS_mul",
        "placeholder"
    ],
    # for mini fp32
    [
        "elewise_binary_add",
        "elewise_binary_mul",
        "broadcast_for_tensor",
        "elewise_binary_mul",
        "placeholder",
        "elewise_binary_mul",
        "elewise_single_VS_add",
        "elewise_single_VS_mul",
        "elewise_binary_mul",
        "elewise_binary_mul",
        "elewise_single_VS_add",
        "elewise_single_VS_mul",
        "elewise_binary_mul",
        "elewise_single_rsqrt",
        "elewise_single_VS_add",
        "elewise_binary_sub",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_mul",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_mul",
        "elewise_single_VS_add",
        "elewise_single_VS_mul",
        "elewise_binary_mul",
        "elewise_single_rec",
        "elewise_binary_mul",
        "elewise_single_VS_add",
        "elewise_single_VS_mul",
        "elewise_binary_mul",
        "elewise_single_rec",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_binary_sub",
        "placeholder",
        "elewise_binary_mul",
        "elewise_binary_add",
        "elewise_single_VS_mul",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_add",
        "elewise_single_VS_mul",
        "elewise_single_VS_mul",
        "elewise_single_VS_mul",
        "placeholder"
    ],
    # for all reduce axis dim is 1, no broadcast node
    [
        "elewise_binary_add",
        "elewise_binary_mul",
        "elewise_binary_div",
        "placeholder",
        "elewise_single_sqrt",
        "elewise_single_VS_add",
        "elewise_binary_sub",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_mul",
        "elewise_single_VS_mul",
        "placeholder",
        "placeholder",
        "elewise_binary_sub",
        "placeholder",
        "elewise_binary_mul",
        "elewise_binary_add",
        "elewise_single_VS_mul",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_add",
        "elewise_single_VS_mul",
        "elewise_single_VS_mul",
        "elewise_single_VS_mul",
        "placeholder"
    ],
    # for update_v3 float16
    [
        "elewise_single_cast|not_auto_cast",
        "elewise_binary_add",
        "elewise_binary_mul",
        "broadcast_for_tensor",
        "elewise_binary_div",
        "placeholder",
        "elewise_single_sqrt",
        "elewise_single_VS_add",
        "elewise_binary_sub",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_mul",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_single_cast|not_auto_cast",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_binary_sub",
        "placeholder",
        "elewise_binary_mul",
        "elewise_single_VS_mul",
        "elewise_single_VS_mul",
    ],
    # for update_v3 + add + relu float16
    [
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_single_VS_mul",
        "elewise_binary_sub",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_mul",
        "elewise_single_VS_mul",
        "elewise_single_relu",
        "elewise_binary_add",
        "elewise_single_cast|not_auto_cast",
        "elewise_binary_add",
        "elewise_binary_mul",
        "broadcast_for_tensor",
        "elewise_binary_div",
        "placeholder",
        "elewise_single_sqrt",
        "elewise_single_VS_add",
        "elewise_single_cast|not_auto_cast",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_binary_sub",
        "placeholder",
        "elewise_binary_mul",
        "placeholder",
        "emit_insn_elewise_binary_cmp|gt|bit",
    ],
    # for update_v3 + relu float16
    [
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_single_VS_mul",
        "elewise_binary_sub",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_mul",
        "elewise_single_VS_mul",
        "elewise_single_relu",
        "elewise_single_cast|not_auto_cast",
        "elewise_binary_add",
        "elewise_binary_mul",
        "broadcast_for_tensor",
        "elewise_binary_div",
        "placeholder",
        "elewise_single_sqrt",
        "elewise_single_VS_add",
        "elewise_single_cast|not_auto_cast",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_binary_sub",
        "placeholder",
        "elewise_binary_mul",
        "emit_insn_elewise_binary_cmp|gt|bit",
    ],
    # for update_v3 float32
    [
        "elewise_binary_add",
        "elewise_binary_mul",
        "broadcast_for_tensor",
        "elewise_binary_div",
        "placeholder",
        "elewise_single_sqrt",
        "elewise_single_VS_add",
        "elewise_binary_sub",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_mul",
        "elewise_single_VS_mul",
        "placeholder",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_binary_sub",
        "placeholder",
        "elewise_binary_mul",
        "elewise_single_VS_mul",
        "elewise_single_VS_mul",
    ],
]

in_update_pattern_list = [
    # in_update, all
    [
        "elewise_binary_add",
        "elewise_binary_mul",
        "elewise_binary_div",
        "elewise_binary_sub",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_single_VS_mul",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_single_sqrt",
        "elewise_single_VS_add",
        "elewise_binary_sub",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_mul",
        "broadcast_for_tensor",
        "placeholder",
        "broadcast_for_tensor",
        "placeholder",
        "elewise_binary_add",
        "elewise_single_VS_mul",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_add",
        "elewise_single_VS_mul",
        "elewise_single_VS_mul",
        "elewise_single_VS_mul",
        "placeholder",
    ],
    # in_update, no mean and variance
    [
        "elewise_binary_add",
        "elewise_binary_mul",
        "elewise_binary_div",
        "elewise_binary_sub",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_single_VS_mul",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_single_sqrt",
        "elewise_single_VS_add",
        "elewise_binary_sub",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_mul",
        "broadcast_for_tensor",
        "placeholder",
        "broadcast_for_tensor",
        "placeholder",
        "elewise_single_VS_mul",
    ],
    # in_update, no mean and variance and gamma and beta
    [
        "elewise_binary_div",
        "elewise_binary_sub",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_single_VS_mul",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_single_sqrt",
        "elewise_single_VS_add",
        "elewise_binary_sub",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_mul",
        "elewise_single_VS_mul",
    ],
    # for in_infer_v2
    [
        "elewise_binary_add",
        "elewise_binary_mul",
        "elewise_binary_sub",
        "placeholder",
        "broadcast_for_tensor",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_binary_mul",
        "placeholder",
        "elewise_single_rsqrt",
        "elewise_single_VS_add",
        "placeholder",
        "broadcast_for_tensor",
        "placeholder",
        "elewise_single_VS_add",
        "elewise_single_VS_add",
    ]
]

gn_update_pattern_list = [
    # gn_update all
    [
        "elewise_binary_add",
        "elewise_binary_mul",
        "elewise_binary_div",
        "elewise_binary_sub",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_single_VS_mul",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_single_sqrt",
        "elewise_single_VS_add",
        "elewise_binary_sub",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_mul",
        "broadcast_for_tensor",
        "placeholder",
        "broadcast_for_tensor",
        "placeholder",
    ],
    # gn_update, no scale and offset
    [
        "elewise_binary_div",
        "elewise_binary_sub",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_single_VS_mul",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_single_sqrt",
        "elewise_single_VS_add",
        "elewise_binary_sub",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_mul",
    ]
]

# 'pylint: disable=invalid-name
softmax_cross_entropy_with_logits_pattern_list = [
    # [NHW,C] fp32
    [
        "reduce_sum",
        "elewise_single_VS_mul",
        "elewise_binary_mul",
        "placeholder",
        "elewise_binary_sub",
        "elewise_binary_sub",
        "placeholder",
        "elewise_single_cast",
        "broadcast_for_tensor",
        "reduce_max",
        "elewise_single_cast",
        "elewise_single_log",
        "broadcast_for_tensor",
        "reduce_sum",
        "elewise_single_exp",
        "elewise_binary_sub",
        "elewise_binary_div",
    ],
    # [NHW,C] fp16
    [
        "elewise_single_cast|not_auto_cast",
        "reduce_sum",
        "elewise_single_VS_mul",
        "elewise_binary_mul",
        "elewise_single_cast|not_auto_cast",
        "placeholder",
        "elewise_binary_sub",
        "elewise_binary_sub",
        "elewise_single_cast|not_auto_cast",
        "placeholder",
        "elewise_single_cast",
        "broadcast_for_tensor",
        "reduce_max",
        "elewise_single_cast",
        "elewise_single_log",
        "broadcast_for_tensor",
        "reduce_sum",
        "elewise_single_exp",
        "elewise_single_cast|not_auto_cast",
        "elewise_binary_sub",
        "elewise_binary_div",
    ],
    # [N,C,H,W] fp32
    [
        "reduce_sum",
        "elewise_single_VS_mul",
        "elewise_binary_mul",
        "placeholder",
        "elewise_binary_sub",
        "elewise_binary_sub",
        "placeholder",
        "broadcast_for_tensor",
        "reduce_max",
        "elewise_single_log",
        "broadcast_for_tensor",
        "reduce_sum",
        "elewise_single_exp",
        "elewise_binary_sub",
        "elewise_binary_div"
    ],
    # [N,C,H,W] fp16
    [
        "elewise_single_cast|not_auto_cast",
        "reduce_sum",
        "elewise_single_VS_mul",
        "elewise_binary_mul",
        "elewise_single_cast|not_auto_cast",
        "placeholder",
        "elewise_binary_sub",
        "elewise_binary_sub",
        "elewise_single_cast|not_auto_cast",
        "placeholder",
        "broadcast_for_tensor",
        "reduce_max",
        "elewise_single_log",
        "broadcast_for_tensor",
        "reduce_sum",
        "elewise_single_exp",
        "elewise_single_cast|not_auto_cast",
        "elewise_binary_sub",
        "elewise_binary_div",
    ],
    # [N,H,W,C] fp32 large high_performance
    [
        "elewise_single_VS_mul",
        "last_axis_reduce_sum_reuse",
        "elewise_binary_mul",
        "placeholder",
        "elewise_binary_sub",
        "elewise_get_L1_workspace",
        "elewise_single_log",
        "reduce_sum",
        "elewise_single_exp",
        "elewise_binary_sub_scalar_L1",
        "placeholder",
        "last_axis_reduce_max",
        "elewise_binary_sub",
        "elewise_binary_div",
    ],
    # [N,H,W,C] fp32 large high_precision
    [
        "elewise_single_VS_mul",
        "last_axis_reduce_sum_reuse",
        "elewise_binary_mul",
        "placeholder",
        "elewise_binary_sub",
        "elewise_get_L1_workspace",
        "elewise_single_log",
        "reduce_sum",
        "elewise_single_exp",
        "elewise_binary_sub_scalar_L1",
        "placeholder",
        "reduce_max",
        "elewise_binary_sub",
        "elewise_binary_div",
    ]
]

# 'pylint: disable=invalid-name
bn_grad_reduce_pattern_list = [
    # fp16
    [
        "elewise_single_cast|not_auto_cast",
        "elewise_binary_mul",
        "elewise_binary_add",
        "elewise_binary_add",
        "elewise_single_cast|not_auto_cast",
        "placeholder",
        "elewise_binary_mul",
        "broadcast_for_tensor",
        "elewise_binary_div",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_single_sqrt",
        "elewise_single_VS_add",
        "placeholder",
        "elewise_single_cast|not_auto_cast",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_binary_add",
        "elewise_binary_mul",
        "elewise_binary_div",
        "placeholder",
        "elewise_single_VS_mul",
        "elewise_single_VS_mul",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_binary_div",
        "placeholder",
    ],
    [
        "elewise_binary_mul",
        "elewise_binary_add",
        "elewise_binary_add",
        "placeholder",
        "elewise_binary_mul",
        "broadcast_for_tensor",
        "elewise_binary_div",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_single_sqrt",
        "elewise_single_VS_add",
        "placeholder",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_binary_add",
        "elewise_binary_mul",
        "elewise_binary_div",
        "placeholder",
        "elewise_single_VS_mul",
        "elewise_single_VS_mul",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_binary_div",
        "placeholder",
    ],
    [
        "elewise_single_cast|not_auto_cast",
        "elewise_binary_mul",
        "elewise_binary_sub",
        "elewise_binary_sub",
        "elewise_single_cast|not_auto_cast",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_mul",
        "broadcast_for_tensor",
        "elewise_single_VS_mul",
        "placeholder",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_binary_mul",
        "placeholder",
        "elewise_binary_div",
        "broadcast",
        "elewise_single_sqrt",
        "elewise_single_VS_add",
        "placeholder",
    ],

    # fp32
    [
        "elewise_binary_mul",
        "elewise_binary_sub",
        "elewise_binary_sub",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_mul",
        "broadcast_for_tensor",
        "elewise_single_VS_mul",
        "placeholder",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_binary_mul",
        "placeholder",
        "elewise_binary_div",
        "broadcast",
        "elewise_single_sqrt",
        "elewise_single_VS_add",
        "placeholder",
    ],
    # for new compute, fp16
    [
        "elewise_single_cast|not_auto_cast",
        "elewise_binary_mul",
        "elewise_binary_sub",
        "elewise_binary_sub",
        "elewise_single_cast|not_auto_cast",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_mul",
        "broadcast_for_tensor",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_mul",
        "elewise_binary_sub",
        "elewise_single_cast|not_auto_cast",
        "placeholder",
        "broadcast_for_tensor",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_binary_div",
        "broadcast",
        "elewise_single_sqrt",
        "elewise_single_VS_add",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_binary_mul",
        "placeholder",
    ],
    # for new compute, fp32
    [
        "elewise_binary_mul",
        "elewise_binary_sub",
        "elewise_binary_sub",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_mul",
        "broadcast_for_tensor",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_mul",
        "elewise_binary_sub",
        "placeholder",
        "broadcast_for_tensor",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_binary_div",
        "broadcast",
        "elewise_single_sqrt",
        "elewise_single_VS_add",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_binary_mul",
        "placeholder",
    ],
    [
        "elewise_single_cast|not_auto_cast",
        "elewise_binary_mul",
        "elewise_binary_sub",
        "elewise_binary_add",
        "elewise_single_cast|not_auto_cast",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_mul",
        "broadcast_for_tensor",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_mul",
        "elewise_binary_add",
        "elewise_single_cast|not_auto_cast",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_single_VS_mul",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_binary_div",
        "broadcast",
        "elewise_single_sqrt",
        "elewise_single_VS_add",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_binary_mul",
        "placeholder",
    ],
    [
        "elewise_binary_mul",
        "elewise_binary_sub",
        "elewise_binary_add",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_mul",
        "broadcast_for_tensor",
        "elewise_single_VS_mul",
        "placeholder",
        "elewise_binary_mul",
        "elewise_binary_add",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_single_VS_mul",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_binary_div",
        "broadcast",
        "elewise_single_sqrt",
        "elewise_single_VS_add",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_binary_mul",
        "placeholder",
    ]
]

# 'pylint: disable=invalid-name
l2_loss_pattern_list = [
    "reduce_sum",
    "elewise_binary_mul",
    "elewise_single_VS_mul",
    "placeholder"
]

# 'pylint: disable=invalid-name
bn_reduce_pattern_list = [
    [
        "tuple_reduce_sum",
        "elewise_single_cast|not_auto_cast",
        "placeholder",
        "elewise_binary_mul",
        "tuple_reduce_sum"
    ],
    [
        "tuple_reduce_sum",
        "placeholder",
        "elewise_binary_mul",
        "tuple_reduce_sum"
    ]
]

# 'pylint: disable=invalid-name
l2loss_mul_addn_pattern_list = [
    [
        "elewise_binary_add",
        "elewise_binary_mul",
        "placeholder",
        "broadcast_for_tensor",
        "placeholder",
        "placeholder",
        "reduce_sum",
        "elewise_binary_mul",
        "elewise_single_VS_mul",
    ]
]

softmax_dfs_tag_list = [  # 'pylint: disable=invalid-name
    # softmax_v2 fp16 nz for special cases
    [
        'elewise_single_cast|not_auto_cast',
        'elewise_binary_mul',
        'elewise_single_exp',
        'elewise_single_cast|not_auto_cast',
        'elewise_binary_sub',
        'elewise_binary_add',
        'elewise_single_VS_add',
        'placeholder',
        'tail_block_pretreatment',
        'broadcast_for_tensor',
        'broadcast_for_tensor',
        'reduce_max',
        'broadcast_for_tensor',
        'broadcast_for_tensor',
        'elewise_single_rec',
        'reduce_sum'
     ],
    # softmax_v2 fp16 nz non16 1980
    [
        "elewise_single_cast|not_auto_cast",
        "elewise_binary_div",
        "elewise_single_exp",
        "elewise_single_cast|not_auto_cast",
        "elewise_binary_sub",
        "elewise_binary_add",
        "elewise_single_VS_add",
        "placeholder",
        "tail_block_pretreatment",
        "broadcast_for_tensor",
        "broadcast_for_tensor",
        "reduce_max",
        "broadcast_for_tensor",
        "broadcast_for_tensor",
        "reduce_sum",
    ],
    # softmax_v2 fp32 nz non16 1980
    [
        "elewise_binary_div",
        "elewise_single_exp",
        "elewise_binary_sub",
        "elewise_binary_add",
        "elewise_single_VS_add",
        "placeholder",
        "tail_block_pretreatment",
        "elewise_single_cast",
        "broadcast_for_tensor",
        "broadcast_for_tensor",
        "reduce_max",
        "elewise_single_cast",
        "broadcast_for_tensor",
        "broadcast_for_tensor",
        "reduce_sum",
    ],
    # softmax fp16 for bert
    [
        "elewise_single_cast|not_auto_cast",
        "elewise_binary_mul",
        "elewise_single_exp",
        "elewise_single_cast|not_auto_cast",
        "elewise_binary_sub",
        "placeholder",
        "broadcast_for_tensor",
        "broadcast_for_tensor",
        "reduce_max",
        "broadcast_for_tensor",
        "broadcast_for_tensor",
        "elewise_single_rec",
        "reduce_sum",
    ],
    # softmaxgrad fp16
    [
        "elewise_single_cast|not_auto_cast",
        "elewise_binary_mul",
        "elewise_single_cast",
        "placeholder",
        "elewise_binary_sub",
        "elewise_single_cast",
        "placeholder",
        "broadcast_for_tensor",
        "reduce_sum",
        "elewise_single_cast|not_auto_cast",
        "elewise_binary_mul",
    ],
    # softmaxgrad fp32
    [
        "elewise_binary_mul",
        "placeholder",
        "elewise_binary_sub",
        "placeholder",
        "broadcast_for_tensor",
        "reduce_sum",
        "elewise_binary_mul",
    ],
    # softmax fp32 last axis, align_factor_32byte = 16
    [
        "elewise_binary_div",
        "elewise_single_exp",
        "elewise_binary_sub",
        "placeholder",
        "elewise_single_cast",
        "broadcast_for_tensor",
        "reduce_max",
        "elewise_single_cast",
        "broadcast_for_tensor",
        "reduce_sum",
    ],
    # softmax fp32 nlst axis, align_factor_32byte = 8
    [
        "elewise_binary_div",
        "elewise_single_exp",
        "elewise_binary_sub",
        "placeholder",
        "broadcast_for_tensor",
        "reduce_max",
        "broadcast_for_tensor",
        "reduce_sum",
    ],
    # softmax fp16 nlst or last axis, align_factor_32byte = 16
    [
        "elewise_single_cast|not_auto_cast",
        "elewise_binary_div",
        "elewise_single_exp",
        "elewise_single_cast|not_auto_cast",
        "elewise_binary_sub",
        "placeholder",
        "broadcast_for_tensor",
        "reduce_max",
        "broadcast_for_tensor",
        "reduce_sum",
    ],
    # log_softmax fp32 last axis, align_factor_32byte = 16
    [
        "elewise_binary_sub",
        "elewise_binary_sub",
        "placeholder",
        "elewise_single_cast",
        "broadcast_for_tensor",
        "reduce_max",
        "elewise_single_cast",
        "broadcast_for_tensor",
        "elewise_single_log",
        "reduce_sum",
        "elewise_single_exp",
    ],
    # log_softmax fp32 nlst axis, align_factor_32byte = 8
    [
        "elewise_binary_sub",
        "elewise_binary_sub",
        "placeholder",
        "broadcast_for_tensor",
        "reduce_max",
        "broadcast_for_tensor",
        "elewise_single_log",
        "reduce_sum",
        "elewise_single_exp",
    ],
    # log_softmax fp16 nlst or last axis, align_factor_32byte = 16
    [
        "elewise_single_cast|not_auto_cast",
        "elewise_binary_sub",
        "elewise_single_cast|not_auto_cast",
        "elewise_binary_sub",
        "placeholder",
        "broadcast_for_tensor",
        "reduce_max",
        "broadcast_for_tensor",
        "elewise_single_log",
        "reduce_sum",
        "elewise_single_exp",
    ],
    # log_softmax_grad fp32 nlst or last axis, align_factor_32byte = 8
    [
        "elewise_binary_sub",
        "placeholder",
        "elewise_binary_mul",
        "elewise_single_exp",
        "placeholder",
        "broadcast_for_tensor",
        "reduce_sum",
    ],
    # log_softmax_grad fp16 nlst or last axis, align_factor_32byte = 16
    [
        "elewise_single_cast|not_auto_cast",
        "elewise_binary_sub",
        "elewise_single_cast|not_auto_cast",
        "placeholder",
        "elewise_binary_mul",
        "elewise_single_exp",
        "elewise_single_cast|not_auto_cast",
        "placeholder",
        "broadcast_for_tensor",
        "reduce_sum",
    ],

    # softmax_v2 fp32 last axis, rec
    [
        "elewise_binary_mul",
        "elewise_single_cast|not_auto_cast",
        "elewise_single_exp",
        "elewise_single_cast",
        "elewise_binary_sub",
        "placeholder",
        "elewise_single_cast",
        "broadcast_for_tensor",
        "reduce_max",
        "elewise_single_cast",
        "elewise_binary_mul",
        "elewise_single_VS_add",
        "elewise_single_VS_mul",
        "elewise_binary_mul",
        "broadcast_for_tensor",
        "reduce_sum",
        "elewise_binary_mul",
        "elewise_single_VS_add",
        "elewise_single_VS_mul",
        "elewise_binary_mul",
        "elewise_single_rec",
    ],
    # softmax_v2 fp32 nlst axis, rec
    [
        "elewise_binary_mul",
        "elewise_single_cast|not_auto_cast",
        "elewise_single_exp",
        "elewise_single_cast",
        "elewise_binary_sub",
        "placeholder",
        "broadcast_for_tensor",
        "reduce_max",
        "elewise_binary_mul",
        "elewise_single_VS_add",
        "elewise_single_VS_mul",
        "elewise_binary_mul",
        "broadcast_for_tensor",
        "reduce_sum",
        "elewise_binary_mul",
        "elewise_single_VS_add",
        "elewise_single_VS_mul",
        "elewise_binary_mul",
        "elewise_single_rec",
    ],
    # softmax_v2 fp16 last nlst axis, rec
    [
        "elewise_single_cast|not_auto_cast",
        "elewise_binary_mul",
        "elewise_single_cast|not_auto_cast",
        "elewise_single_exp",
        "elewise_binary_sub",
        "placeholder",
        "broadcast_for_tensor",
        "reduce_max",
        "elewise_binary_mul",
        "elewise_single_VS_add",
        "elewise_single_VS_mul",
        "elewise_binary_mul",
        "broadcast_for_tensor",
        "reduce_sum",
        "elewise_binary_mul",
        "elewise_single_VS_add",
        "elewise_single_VS_mul",
        "elewise_binary_mul",
        "elewise_single_rec",
    ],
    # softmax fp32 nlst or last axis, rec
    [
        "elewise_binary_mul",
        "elewise_single_exp",
        "elewise_single_cast",
        "elewise_binary_sub",
        "placeholder",
        "elewise_single_cast",
        "broadcast_for_tensor",
        "reduce_max",
        "elewise_single_cast",
        "elewise_binary_mul",
        "elewise_single_VS_add",
        "elewise_single_VS_mul",
        "elewise_binary_mul",
        "broadcast_for_tensor",
        "reduce_sum",
        "elewise_binary_mul",
        "elewise_single_VS_add",
        "elewise_single_VS_mul",
        "elewise_binary_mul",
        "elewise_single_rec",
    ],
    [
        "elewise_binary_mul",
        "elewise_single_exp",
        "elewise_single_cast",
        "elewise_binary_sub",
        "placeholder",
        "broadcast_for_tensor",
        "reduce_max",
        "elewise_binary_mul",
        "elewise_single_VS_add",
        "elewise_single_VS_mul",
        "elewise_binary_mul",
        "broadcast_for_tensor",
        "reduce_sum",
        "elewise_binary_mul",
        "elewise_single_VS_add",
        "elewise_single_VS_mul",
        "elewise_binary_mul",
        "elewise_single_rec",
    ],
    # softmax fp16 nlst or last axis, rec
    [
        "elewise_binary_mul",
        "elewise_single_exp",
        "elewise_single_cast",
        "elewise_single_cast|not_auto_cast",
        "elewise_binary_sub",
        "placeholder",
        "broadcast_for_tensor",
        "reduce_max",
        "elewise_binary_mul",
        "elewise_single_VS_add",
        "elewise_single_VS_mul",
        "elewise_binary_mul",
        "broadcast_for_tensor",
        "reduce_sum",
        "elewise_binary_mul",
        "elewise_single_VS_add",
        "elewise_single_VS_mul",
        "elewise_binary_mul",
        "elewise_single_rec",
    ],

    # log_softmax fp32 nlst or last axis, mini
    [
        "elewise_binary_sub",
        "elewise_binary_sub",
        "placeholder",
        "elewise_single_cast",
        "broadcast_for_tensor",
        "reduce_max",
        "elewise_single_cast",
        "elewise_single_cast",
        "broadcast_for_tensor",
        "elewise_single_log",
        "reduce_sum",
        "elewise_single_exp",
        "elewise_single_cast",
    ],
    # log_softmax fp16 nlst or last axis, mini
    [
        "elewise_single_cast|not_auto_cast",
        "elewise_binary_sub",
        "elewise_single_cast|not_auto_cast",
        "elewise_binary_sub",
        "placeholder",
        "broadcast_for_tensor",
        "reduce_max",
        "elewise_single_cast",
        "broadcast_for_tensor",
        "elewise_single_log",
        "reduce_sum",
        "elewise_single_exp",
        "elewise_single_cast",
    ],

    # log_softmax_grad fp32 nlst or last axis, mini
    [
        "elewise_binary_sub",
        "placeholder",
        "elewise_binary_mul",
        "elewise_single_cast",
        "elewise_single_exp",
        "elewise_single_cast",
        "placeholder",
        "broadcast_for_tensor",
        "reduce_sum",
    ],
    # log_softmax_grad fp16 nlst or last axis, mini
    [
        "elewise_single_cast|not_auto_cast",
        "elewise_binary_sub",
        "elewise_single_cast|not_auto_cast",
        "placeholder",
        "elewise_binary_mul",
        "elewise_single_cast",
        "elewise_single_exp",
        "elewise_single_cast",
        "elewise_single_cast|not_auto_cast",
        "placeholder",
        "broadcast_for_tensor",
        "reduce_sum",
    ],

    # softmax_v2 fp16 nlst or last axis, rec de_newton
    [
        "elewise_single_cast|not_auto_cast",
        "elewise_binary_mul",
        "elewise_single_cast|not_auto_cast",
        "elewise_single_exp",
        "elewise_binary_sub",
        "placeholder",
        "broadcast_for_tensor",
        "reduce_max",
        "elewise_binary_mul",
        "elewise_single_VS_add",
        "elewise_single_VS_mul",
        "elewise_binary_mul",
        "broadcast_for_tensor",
        "reduce_sum",
        "elewise_single_rec",
    ],
    # softmax_v2 fp32 last axis, rec de_newton
    [
        "elewise_binary_mul",
        "elewise_single_cast|not_auto_cast",
        "elewise_single_exp",
        "elewise_single_cast",
        "elewise_binary_sub",
        "placeholder",
        "elewise_single_cast",
        "broadcast_for_tensor",
        "reduce_max",
        "elewise_single_cast",
        "elewise_binary_mul",
        "elewise_single_VS_add",
        "elewise_single_VS_mul",
        "elewise_binary_mul",
        "broadcast_for_tensor",
        "reduce_sum",
        "elewise_single_rec",
    ],
    # softmax_v2 fp32 nlst axis, rec de_newton
    [
        "elewise_binary_mul",
        "elewise_single_cast|not_auto_cast",
        "elewise_single_exp",
        "elewise_single_cast",
        "elewise_binary_sub",
        "placeholder",
        "broadcast_for_tensor",
        "reduce_max",
        "elewise_binary_mul",
        "elewise_single_VS_add",
        "elewise_single_VS_mul",
        "elewise_binary_mul",
        "broadcast_for_tensor",
        "reduce_sum",
        "elewise_single_rec",
    ],
    # confusion_softmax_grad fp32
    [
        "elewise_binary_sub",
        "placeholder",
        "broadcast_for_tensor",
        "reduce_sum",
        "elewise_binary_mul",
        "placeholder",
    ],

]

l2_normalize_dfs_tag_list = [  # 'pylint: disable=invalid-name
    # fp32
    [
        "elewise_binary_div",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_single_sqrt",
        "elewise_single_VS_max",
        "reduce_sum",
        "elewise_binary_mul",
    ],
    [
        "elewise_binary_div",
        "placeholder",
        "elewise_single_sqrt",
        "elewise_single_VS_max",
        "reduce_sum",
        "elewise_binary_mul",
    ],

    # fp16
    [
        "elewise_single_cast|not_auto_cast",
        "elewise_binary_div",
        "elewise_single_cast|not_auto_cast",
        "placeholder",
        "broadcast_for_tensor",
        "elewise_single_sqrt",
        "elewise_single_VS_max",
        "reduce_sum",
        "elewise_binary_mul",
    ],
    [
        "elewise_single_cast|not_auto_cast",
        "elewise_binary_div",
        "elewise_single_cast|not_auto_cast",
        "placeholder",
        "elewise_single_sqrt",
        "elewise_single_VS_max",
        "reduce_sum",
        "elewise_binary_mul",
    ],
]

relu_v2_tag_list = [  # 'pylint: disable=invalid-name
    # fp16
    [
        "elewise_single_relu",
        "placeholder",
        "emit_insn_elewise_binary_cmp|gt|bit",
    ],
    # fp32
    [
        "elewise_binary_max",
        "placeholder",
        "broadcast",
        "emit_insn_elewise_binary_cmp|gt|bit",
        "elewise_single_cast|not_auto_cast",
    ],
]

floor_mod_tag_list = [
    # mini_fp16
    [
        "elewise_binary_sub",
        "broadcast_for_tensor",
        "placeholder",
        "elewise_binary_mul",
        "elewise_single_cast|not_auto_cast",
        "elewise_single_floor",
        "elewise_binary_mul",
        "elewise_binary_mul",
        "elewise_single_VS_add",
        "elewise_single_VS_mul",
        "elewise_binary_mul",
        "placeholder",
        "elewise_single_rec",
    ],

    # mini_32
    [
        "elewise_binary_sub",
        "broadcast_for_tensor",
        "placeholder",
        "elewise_binary_mul",
        "elewise_single_cast",
        "elewise_single_cast|not_auto_cast",
        "elewise_single_floor",
        "elewise_single_cast",
        "elewise_binary_mul",
        "elewise_binary_mul",
        "elewise_single_VS_add",
        "elewise_single_VS_mul",
        "elewise_binary_mul",
        "placeholder",
        "elewise_single_rec",
    ],

    # cloud_16
    [
        "elewise_binary_sub",
        "broadcast_for_tensor",
        "placeholder",
        "elewise_binary_mul",
        "elewise_single_cast|not_auto_cast",
        "elewise_single_floor",
        "elewise_binary_div",
        "placeholder",
    ],

    # cloud_32
    [
        "elewise_binary_sub",
        "broadcast_for_tensor",
        "placeholder",
        "elewise_binary_mul",
        "elewise_single_cast",
        "elewise_single_cast|not_auto_cast",
        "elewise_single_floor",
        "elewise_binary_div",
        "placeholder",
    ],
]

threshold_grad_v2_d_tag_list = [
    # mini_fp16 & cloud_fp16_fp32
    [
        "elewise_binary_cmpsel_gt|gt",
        "placeholder",
        "placeholder",
    ],

    # others
    [
        "elewise_binary_cmpsel_gt|gt",
        "elewise_single_cast",
        "placeholder",
        "elewise_single_cast",
        "placeholder",
    ],
]

truncate_div_tag_list = [  # 'pylint: disable=invalid-name
    # mini_fp16
    [
        "elewise_binary_mul",
        "placeholder",
        "elewise_binary_mul",
        "elewise_single_VS_add",
        "elewise_single_VS_mul",
        "elewise_binary_mul",
        "broadcast_for_tensor",
        "placeholder",
        "elewise_single_rec",
    ],
    [
        "elewise_binary_mul",
        "broadcast_for_tensor",
        "placeholder",
        "elewise_binary_mul",
        "elewise_single_VS_add",
        "elewise_single_VS_mul",
        "elewise_binary_mul",
        "placeholder",
        "elewise_single_rec",
    ],
]

reduce_mean_2d_aligned_mid_reduce_no_cast_list = [  # 'pylint: disable=invalid-name
    [
        "reduce_sum",
        "elewise_single_VS_mul",
        "placeholder",
    ],
]

cosine_embedding_loss_tag_list = [
    # not contain elewise_single_cast and broadcast_for_tensor
    [
        "elewise_binary_add",
        "elewise_binary_cmpsel_eq|eq",
        "placeholder",
        "elewise_single_VS_add",
        "elewise_single_VS_mul",
        "elewise_binary_sub",
        "elewise_binary_div",
        "reduce_sum",
        "elewise_binary_mul",
        "placeholder",
        "placeholder",
        "elewise_binary_mul",
        "elewise_single_sqrt",
        "elewise_single_VS_add",
        "reduce_sum",
        "elewise_binary_mul",
        "elewise_single_sqrt",
        "elewise_single_VS_add",
        "reduce_sum",
        "elewise_binary_mul",
        "elewise_binary_cmpsel_eq|eq",
        "elewise_binary_sub",
        "elewise_binary_max",
        "elewise_binary_sub",
        "elewise_single_VS_mul",
    ]
]
