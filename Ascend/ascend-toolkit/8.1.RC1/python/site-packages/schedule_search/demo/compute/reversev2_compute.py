#!/usr/bin/env python3
# -*- coding: UTF-8 -*-
"""
Copyright (c) Huawei Technologies Co., Ltd. 2019-2020. All rights reserved.

rl schedule search, tss
"""
from tbe.tvm.topi.cce import util

from tbe import tvm


def reversev2_compute(shape, dtype, axis_list):
    """

    :param shape:
    :param dtype:
    :param axis_list:
    :return:
    """
    util.check_reduce_shape_rule(shape)
    refine_axis = util.axis_check(len(shape), axis_list)
    if len(set(refine_axis)) != len(refine_axis):
        raise RuntimeError("an index is specified more than once")

    if refine_axis[len(refine_axis) - 1] == len(shape) - 1:
        raise RuntimeError("reverse_cce do not support the last axis")

    data = tvm.placeholder(shape, dtype, name='data')

    def _compute(*indice):
        new_indice = []
        for i, indice_item in enumerate(indice):
            if i in refine_axis:
                row = shape[i] - 1
                new_indice.append(row - indice_item)
            else:
                new_indice.append(indice_item)
        return data(*new_indice)

    output = tvm.compute(shape,
                         _compute,
                         name="reverse",
                         tag="mov_backup",
                         attrs={"reverse_axis": refine_axis})
    return output
