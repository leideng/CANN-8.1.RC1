#!/usr/bin/env python3
# -*- coding: UTF-8 -*-
"""
Copyright (c) Huawei Technologies Co., Ltd. 2019-2020. All rights reserved.

rl schedule search, tss
"""
from schedule_search import log


def proc(progress, action_mask):
    """
    规则内容： at目标中不存在的给Mask掉
    """

    stage_index = progress.todo.stage_index
    consumer_id = progress.todo.sub_action_index

    at_info = progress.op_schedule_info.stages_info[stage_index]['at_info']
    consumer = at_info.consumers[consumer_id]
    at_stage_num = len(consumer.at_candidates)
    for i in range(at_stage_num, len(action_mask)):
        action_mask[i] = 0

    if sum(action_mask) == 0:
        log.warn('No need to mask, because no available at target.')

    return action_mask
