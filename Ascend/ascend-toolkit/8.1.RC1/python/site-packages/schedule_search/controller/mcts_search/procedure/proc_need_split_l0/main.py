#!/usr/bin/env python3
# -*- coding: UTF-8 -*-
"""
Copyright (c) Huawei Technologies Co., Ltd. 2019-2020. All rights reserved.

rl schedule search, tss
"""
from schedule_search.controller.mcts_search.procedure.comm import \
    get_split_todo


def proc(progress):
    """
    gemm最开始先采样是否切分L0，然后进行切分
    """
    # 1表示切，0表示不切
    need_split_l0 = bool(progress.todo.action_value)

    stage_index = progress.todo.stage_index
    stage_info = progress.op_schedule_info.stages_info[stage_index]
    stage_info['need_split_l0'] = need_split_l0

    # 先切mn，再切MN
    if need_split_l0:
        next_todo = get_split_todo(progress, stage_index,
                                   cache_layer=progress.op_layers - 1)
    # 直接切MN
    else:
        next_todo = get_split_todo(progress, stage_index,
                                   cache_layer=progress.op_layers - 2)

    progress.todo = next_todo
