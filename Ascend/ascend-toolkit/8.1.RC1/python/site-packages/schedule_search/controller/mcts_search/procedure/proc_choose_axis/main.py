#!/usr/bin/env python3
# -*- coding: UTF-8 -*-
"""
Copyright (c) Huawei Technologies Co., Ltd. 2019-2020. All rights reserved.

rl schedule search, tss
"""
from schedule_search.controller.mcts_search.procedure.action import ActionType
from schedule_search.controller.mcts_search.procedure.action import \
    SearcherAction
from schedule_search.controller.search_comm import get_split_sub_tree_depth


def proc(progress):
    """
    选完轴之后，必然是对该轴进行切分
    """
    chosen_axis = progress.todo.action_value
    stage_index = progress.todo.stage_index
    curr_stage_nonzero_axes = progress.get_nonzero_axes(stage_index)
    chosen_axis_len = curr_stage_nonzero_axes[chosen_axis]
    curr_split_depth = get_split_sub_tree_depth(chosen_axis_len)
    next_todo = SearcherAction(
        stage_index=progress.todo.stage_index,
        action_type=ActionType.split,
        cache_layer=0,
        sub_action_index=curr_split_depth - 1,
        axis_index=chosen_axis,
        choose_axis_and_split_map=progress.todo.choose_axis_and_split_map
    )
    progress.todo = next_todo
