#!/usr/bin/env python3
# -*- coding: UTF-8 -*-
"""
Copyright (c) Huawei Technologies Co., Ltd. 2019-2020. All rights reserved.

rl schedule search, tss
"""
from schedule_search.ts_env.tensor_cfg import ActionTensorCfg
from schedule_search.ts_env.tensor_to_code import t2c_util
from schedule_search.timer import timer


@timer('r02')
def proc(t2c_params):
    """
    规则内容：不存在的op_layer不切分
    """
    op_layers = t2c_params.op_layers
    cleaned_actions = t2c_params.cleaned_actions
    stage_num = len(cleaned_actions)
    axis_num = t2c_util.max_axis()
    factor_num = ActionTensorCfg.split_factor_e + 1
    factor_num -= ActionTensorCfg.split_factor_s
    for stage_index in range(stage_num):
        for i in range(axis_num * op_layers, factor_num):
            factor_index = ActionTensorCfg.split_factor_s + i
            t2c_params.cleaned_actions[stage_index][factor_index] = 0
