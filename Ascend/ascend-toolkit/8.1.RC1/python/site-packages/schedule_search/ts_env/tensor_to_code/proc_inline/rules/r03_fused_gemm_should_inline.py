#!/usr/bin/env python3
# -*- coding: UTF-8 -*-
"""
Copyright (c) Huawei Technologies Co., Ltd. 2019-2020. All rights reserved.

rl schedule search, tss
"""
from schedule_search import comm
from schedule_search.ts_env.tensor_to_code.proc_inline.rules.comm import \
    is_special_stage


def proc(t2c_params, stage_index):
    """
    gemm后融合其它算子，tensor_c_gm需要被inline
    """
    c_op = t2c_params.op_schedule_info.c_op
    if c_op not in comm.MAD_OP_ID_LIST:
        return False

    stage_info = t2c_params.stages_info[stage_index]
    if 'gemm_out' in stage_info.get('type', []) and \
            stage_index != len(t2c_params.schedule.stages) - 1:
        return True

    return False
