#!/usr/bin/env python3
# -*- coding: UTF-8 -*-
"""
Copyright (c) Huawei Technologies Co., Ltd. 2019-2020. All rights reserved.

rl schedule search, tss
"""
from schedule_search.ts_env.tensor_cfg import ActionTensorCfg
from schedule_search.ts_env.tensor_to_code import t2c_util


def proc(t2c_params):  # pylint: disable=R0912
    """
    规则内容：没切的stage不进行reorder
    """
    # 输入
    axis_info_list = t2c_params.axis_info_list
    axis_num = t2c_util.max_axis()
    layer_num = (ActionTensorCfg.reorder_e + 1 -
                 ActionTensorCfg.reorder_s) // axis_num

    for stage_index, stage_axis_info in enumerate(axis_info_list):
        # 如果axis_info为None，表明这个Stage没有做Split，那也不要做Reorder了
        if stage_axis_info is not None:
            continue
        for layer_index in range(layer_num):
            for axis_index in range(axis_num):
                index_in_tensor = ActionTensorCfg.reorder_s + \
                                  layer_index * axis_num + \
                                  axis_index
                t2c_params.cleaned_actions[stage_index][index_in_tensor] \
                    = axis_index
