#!/usr/bin/env python3
# -*- coding: UTF-8 -*-
# Copyright (c) Huawei Technologies Co., Ltd. 2022-2022. All rights reserved.
"""
common director
"""
from typing import NoReturn

from auto_search.solution_space.action import director_register
from auto_search.solution_space.action import SearchActionType
from auto_search.compute_analysis import ComputePattern
from auto_search.solution_space.prepare_action.at_analysis.at_analysis_action import AtAnalysisAction
from auto_search.solution_space.search_action.atomic_ra_bind.atomic_ra_bind_action import AtomicRABindAction
from auto_search.solution_space.progress import Progress
from auto_search.compute_analysis import support_atomic_ra_bind_search


@director_register([ComputePattern.REDUCE], SearchActionType.ATOMIC)
def direct(progress: Progress) -> NoReturn:
    """
    :param progress:
    :return:
    """
    pattern = progress.op_schedule_info.op_pattern
    next_action = AtAnalysisAction(pattern)
    progress.todo = next_action


@director_register([ComputePattern.TUPLE_REDUCE], SearchActionType.ATOMIC)
def tuple_reduce_direct(progress: Progress) -> NoReturn:
    """
    tuple reduce director
    :param progress:
    :return:
    """
    pattern = progress.op_schedule_info.op_pattern
    if support_atomic_ra_bind_search(progress.op_schedule_info):
        next_action = AtomicRABindAction(pattern)
    else:
        next_action = AtAnalysisAction(pattern)
    progress.todo = next_action

