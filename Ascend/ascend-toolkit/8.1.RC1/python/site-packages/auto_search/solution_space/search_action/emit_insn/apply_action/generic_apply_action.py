#!/usr/bin/env python3
# -*- coding: UTF-8 -*-
# Copyright (c) Huawei Technologies Co., Ltd. 2022-2022. All rights reserved.
"""
common apply action
"""
from typing import NoReturn

from auto_search.solution_space.action import apply_action_register
from auto_search.solution_space.action import SearchActionType
from auto_search.compute_analysis import ComputePattern
from auto_search.solution_space.tensor_cfg import ActionTensorCfg
from auto_search.solution_space.progress import Progress


@apply_action_register([ComputePattern.TRANSPOSE], SearchActionType.EMIT_INSN)
def apply(next_progress: Progress, action_value: int) -> NoReturn:
    """
    emit insn action value apply
    :param next_progress: Progress
    :param action_value: action value
    :return: no return
    """
    stages_info = next_progress.op_schedule_info.stages_info
    for stage_idx, stage_info in enumerate(stages_info):
        if stage_info.get('tag') in ["transpose"]:
            next_progress.action_tensor[stage_idx][ActionTensorCfg.emit_insn_s] = action_value
