#!/usr/bin/env python3
# -*- coding: UTF-8 -*-
# Copyright (c) Huawei Technologies Co., Ltd. 2022-2022. All rights reserved.
"""
common apply action
"""
from auto_search.solution_space.action import apply_action_register
from auto_search.solution_space.action import SearchActionType
from auto_search.compute_analysis import ComputePattern


@apply_action_register([ComputePattern.NORM], SearchActionType.CHOOSE_CACHE_CLONE)
def apply(next_progress, action_value):
    """
    :param next_progress:
    :param action_value:
    :return:
    """
    stage_index = next_progress.todo.stage_index
    stage_info = next_progress.op_schedule_info.stages_info[stage_index]
    stage_info.setdefault('type', [])
    if action_value == 0 and 'workspace' not in stage_info['type']:
        if 'cache_clone' in stage_info['type']:
            stage_info['type'].remove('cache_clone')
        stage_info['type'].append('workspace')
    elif action_value == 1 and 'cache_clone' not in stage_info['type']:
        if 'workspace' in stage_info['type']:
            stage_info['type'].remove('workspace')
        stage_info['type'].append('cache_clone')
