#!/usr/bin/env python3
# -*- coding: UTF-8 -*-
# Copyright (c) Huawei Technologies Co., Ltd. 2022-2022. All rights reserved.
"""
mask rule
"""
from numpy import ndarray

from auto_search.utils import logger
from auto_search.solution_space.features import SEARCH_N
from auto_search.solution_space.action import mask_rule_register
from auto_search.solution_space.action import SearchActionType
from auto_search.compute_analysis import ComputePattern
from auto_search.solution_space.progress import Progress


@mask_rule_register([ComputePattern.TUPLE_REDUCE, ComputePattern.REDUCE], SearchActionType.UB_TRANSPOSE)
def mask(progress: Progress, action_mask: ndarray) -> ndarray:
    """
    :param progress:
    :param action_mask:
    :return:
    """
    for idx in range(SEARCH_N):
        if idx > 1:
            action_mask[idx] = 0
    logger.debug("action: %s action_mask is %s after do generic_only_need_two_type rule", progress.todo, action_mask)
    return action_mask
