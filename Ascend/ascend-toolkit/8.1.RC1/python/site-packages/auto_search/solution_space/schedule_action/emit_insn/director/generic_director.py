#!/usr/bin/env python3
# -*- coding: UTF-8 -*-
# Copyright (c) Huawei Technologies Co., Ltd. 2022-2022. All rights reserved.
"""
common director
"""
from auto_search.solution_space.action import director_register
from auto_search.solution_space.action import ScheduleActionType
from auto_search.compute_analysis import ComputePattern
from auto_search.solution_space.schedule_action.set_buffer_size.set_buffer_size_action \
    import SetBufferSizeAction
from auto_search.solution_space.schedule_action.storage_align.storage_align_action \
    import StorageAlignAction
from auto_search.solution_space.schedule_action.compute_align.compute_align_action \
    import ComputeAlignAction


@director_register([ComputePattern.ELEMENTWISE, ComputePattern.POOLING], ScheduleActionType.EMIT_INSN)
def elementwise_direct(progress):
    """
    :param progress:
    :return:
    """
    pattern = progress.op_schedule_info.op_pattern
    next_todo = SetBufferSizeAction(pattern)
    progress.todo = next_todo


@director_register([ComputePattern.NORM, ComputePattern.TRANSPOSE, ComputePattern.TUPLE_REDUCE, ComputePattern.REDUCE],
                   ScheduleActionType.EMIT_INSN)
def direct(progress):
    """
    :param progress:
    :return:
    """
    pattern = progress.op_schedule_info.op_pattern
    next_todo = StorageAlignAction(pattern)
    progress.todo = next_todo


@director_register([ComputePattern.BROADCAST], ScheduleActionType.EMIT_INSN)
def broadcast_direct(progress):
    """
    :param progress:
    :return:
    """
    pattern = progress.op_schedule_info.op_pattern
    next_todo = ComputeAlignAction(pattern)
    progress.todo = next_todo
