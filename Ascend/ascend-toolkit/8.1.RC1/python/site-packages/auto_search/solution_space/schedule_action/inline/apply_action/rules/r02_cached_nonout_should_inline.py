#!/usr/bin/env python3
# -*- coding: UTF-8 -*-
# Copyright (c) Huawei Technologies Co., Ltd. 2022-2022. All rights reserved.
"""
inline rule
"""
from __future__ import absolute_import

from auto_search.utils import logger
from auto_search.solution_space.progress import Progress


def proc(progress: Progress, stage_index: int) -> bool:
    """
    gm tensor need inline
    :param progress:
    :param stage_index:
    :return:
    """
    op_schedule_info = progress.op_schedule_info
    stage = op_schedule_info.schedule_obj.stages[stage_index]

    if '.local.' in stage.op.name:
        return False

    for input_tensor in stage.op.input_tensors:
        # the stage that has been cache write no need inline
        if '.local.' in input_tensor.op.name:
            return True

    return False
