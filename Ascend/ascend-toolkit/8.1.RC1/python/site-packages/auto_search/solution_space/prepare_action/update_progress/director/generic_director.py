#!/usr/bin/env python3
# -*- coding: UTF-8 -*-
# Copyright (c) Huawei Technologies Co., Ltd. 2022-2022. All rights reserved.
"""
common director
"""
from auto_search.solution_space.action import director_register
from auto_search.solution_space.action import PrepareActionType
from auto_search.compute_analysis import ComputePattern
from auto_search.solution_space.search_action.choose_axis.choose_axis_action import ChooseAxisAction
from auto_search.solution_space.search_action.double_buffer.double_buffer_action import DoubleBufferAction


@director_register([ComputePattern.ELEMENTWISE, ComputePattern.NORM, ComputePattern.BROADCAST,
                    ComputePattern.REDUCE, ComputePattern.POOLING, ComputePattern.TUPLE_REDUCE],
                   PrepareActionType.UPDATE_PROGRESS)
def direct(progress):
    """
    common update_progress direct
    :param progress:
    :return:
    """
    pattern = progress.op_schedule_info.op_pattern
    progress.todo = DoubleBufferAction(pattern)


@director_register([ComputePattern.TRANSPOSE], PrepareActionType.UPDATE_PROGRESS)
def transpose_direct(progress):
    """
    update_progress direct
    :param progress:
    :return:
    """
    pattern = progress.op_schedule_info.op_pattern
    stage_index = progress.stage_num - 1
    progress.todo = ChooseAxisAction(pattern, stage_index)
