#!/usr/bin/env python3
# -*- coding: UTF-8 -*-
# Copyright (c) Huawei Technologies Co., Ltd. 2022-2022. All rights reserved.
"""
common apply action
"""
from auto_search.solution_space.action import apply_action_register
from auto_search.solution_space.action import PrepareActionType
from auto_search.compute_analysis import ComputePattern


@apply_action_register(ComputePattern.ELEMENTWISE, PrepareActionType.UPDATE_WORKSPACE_TYPE)
def apply(progress):
    """
    update workspace type apply
    :param progress:
    :return:
    """
    op_schedule_info = progress.op_schedule_info
    stages_info = op_schedule_info.stages_info

    for stage_info in stages_info:
        at_info = stage_info.get('at_info', None)
        # set attr workspace for workspace node
        if at_info and at_info.is_fork() \
                and 'placeholder' not in stage_info.get('type', []):
            stage_info.setdefault('type', [])
            if 'workspace' not in stage_info['type']:
                stage_info['type'].append('workspace')
