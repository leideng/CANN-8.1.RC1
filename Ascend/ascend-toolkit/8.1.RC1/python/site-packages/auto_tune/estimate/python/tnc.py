#!/usr/bin/env python
# -*- coding:utf-8 -*-
"""
Copyright (C) 2019. Huawei Technologies Co., Ltd. All rights reserved.

TelnetClient Class. Here TelnetClient Class is the client for telenet.
"""
import telnetlib
import socket


class TelnetClient():
    """
    class of telnet client
    """
    def __init__(self, client_ip: str, port: int, uname: str, passwd: str) -> None:
        """
        init the telnetclient class
        """
        self.tel = telnetlib.Telnet()
        self.client_ip = client_ip
        self.port = port
        self.uname = uname
        self.passwd = passwd

    def connect(self, timeout: int = 5) -> int:
        '''
        build connect
        '''
        try:
            self.tel.open(self.client_ip, self.port, timeout=timeout)
        except (TimeoutError, socket.gaierror):
            return -1
        finally:
            pass

        self.tel.read_until(b'login: ', 10)
        self.tel.write(self.uname.encode('ascii') + b'\n')
        self.tel.read_until(b'Password: ', 1)
        self.tel.write(self.passwd.encode('ascii') + b'\n')
        self.tel.read_until(b'# ', 5)
        return 0

    def close(self) -> None:
        '''
        close the connect
        '''
        self.tel.close()

    def execute(self, cmd: str, prompt: str = '# ', timeout: int = 60) -> str:
        """
        method of execute
        """
        if self.connect() == -1:
            result = '%s connection failed' % self.client_ip
            return result

        self.tel.write(cmd.encode('ascii') + b'\n')
        result = self.tel.read_until(prompt.encode('ascii'), timeout)
        self.close()
        return result.decode('ascii')
